<!DOCTYPE html>
<!-- Coding By CodingNepal - youtube.com/@codingnepal -->
<html lang="pt-br">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P√°gina inicial | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="src/css/style.css" />
    <!-- Linking Google fonts for icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="site-nav">
      <button class="sidebar-toggle">
        <span class="material-symbols-rounded">Menu</span>
      </button>
    </nav>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar collapsed">
            <!-- Sidebar header -->
            <div class="sidebar-header">
            <img src="src/img/Logo_senai.png" alt="Logo" class="header-logo"/>
            <button class="sidebar-toggle">
                <span class="material-symbols-rounded">chevron_left</span>
            </button>
            </div>
            <div class="sidebar-content">
            <!-- Search Form -->
            <form action="#" class="search-form">
                <span class="material-symbols-rounded">search</span>
                <input type="search" placeholder="Search..." required />
            </form>
            <!-- Sidebar Menu -->
            <ul class="menu-list">
                <li class="menu-item">
                <a href="#" class="menu-link active">
                    <span class="material-symbols-rounded">dashboard</span>
                    <span class="menu-label">Dashboard</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="an√°lises.html" class="menu-link">
                    <span class="material-symbols-rounded">insert_chart</span>
                    <span class="menu-label">An√°lises</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="notifica√ß√µes.html" class="menu-link">
                    <span class="material-symbols-rounded">notifications</span>
                    <span class="menu-label">Notifica√ß√µes</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="participantes.html" class="menu-link">
                    <span class="material-symbols-rounded">group</span>
                    <span class="menu-label">Participantes</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="configura√ß√µes.html" class="menu-link">
                    <span class="material-symbols-rounded">settings</span>
                    <span class="menu-label">Configura√ß√µes</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="seguran√ßa.html" class="menu-link">
                    <span class="material-symbols-rounded">security</span>
                    <span class="menu-label">Seguran√ßa</span>
                </a>
                </li>
                <li class="menu-item">
                <a href="desenvolvedores.html" class="menu-link">
                    <span class="material-symbols-rounded">code</span>
                    <span class="menu-label">Desenvolvedores</span>
                </a>
                </li>
            </ul>
            </div>
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
            <button class="theme-toggle">
                <div class="theme-label">
                <span class="theme-icon material-symbols-rounded">dark_mode</span>
                <span class="theme-text">Modo escuro</span>
                </div>
                <div class="theme-toggle-track">
                <div class="theme-toggle-indicator"></div>
                </div>
            </button>
            </div>
        </aside>

        <h1 class="page-title">Dashboard - Monitoramento da Caixa D'√Ågua</h1>

    </div>
    
    <footer class="site-footer">
        <div class="footer-content">
            <p>&copy; 2025 Desenvolvido pela ScriptHadder. Todos os direitos reservados.</p>
            <ul class="footer-links">
                <li><a href="privacidade.html">Pol√≠tica de Privacidade</a></li>
                <li><a href="termos.html">Termos de Uso</a></li>
                <li><a href="contato.html">Contato</a></li>
            </ul>
        </div>
    </footer>

    <script src="src/js/script.js"></script>
    <script>
        const progressCircle = document.getElementById('progress');
        const percentText = document.getElementById('percent-text');
        const colorStatus = document.getElementById('color-status');
        const radius = 100;
        const circumference = 2 * Math.PI * radius;

        progressCircle.style.strokeDasharray = circumference;
        progressCircle.style.strokeDashoffset = circumference;

        function setProgress(percent) {
        const offset = circumference - (percent / 100) * circumference;
        progressCircle.style.strokeDashoffset = offset;
        percentText.textContent = percent + '%';

        if (percent > 70) {
            progressCircle.style.stroke = '#2a9d8f';
            percentText.style.fill = '#2a9d8f';
            colorStatus.textContent = 'N√≠vel alto - Bom abastecimento üíß';
            colorStatus.style.color = '#2a9d8f';
        } else if (percent > 40) {
            progressCircle.style.stroke = '#f4a261';
            percentText.style.fill = '#f4a261';
            colorStatus.textContent = 'N√≠vel m√©dio - Aten√ß√£o ‚ö†Ô∏è';
            colorStatus.style.color = '#f4a261';
        } else {
            progressCircle.style.stroke = '#e76f51';
            percentText.style.fill = '#e76f51';
            colorStatus.textContent = 'N√≠vel baixo - Reabastecer urgente üî•';
            colorStatus.style.color = '#e76f51';
        }
        }

        const ctx = document.getElementById('chart').getContext('2d');
        const chartData = {
        labels: [],
        datasets: [{
            label: 'N√≠vel (%)',
            data: [],
            fill: true,
            backgroundColor: 'rgba(42, 157, 143, 0.2)',
            borderColor: '#2a9d8f',
            borderWidth: 3,
            tension: 0.3,
            pointRadius: 4,
            pointHoverRadius: 6,
        }]
        };

        const nivelChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            animation: { duration: 1000 },
            scales: {
            y: {
                suggestedMin: 0,
                suggestedMax: 100,
                ticks: { stepSize: 10 }
            },
            x: {
                ticks: {
                maxRotation: 45,
                minRotation: 45
                }
            }
            }
        }
        });

        function formatHora(date) {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        async function atualizarDashboard() {
        try {
            const res = await fetch('http://localhost:5000/api/ultimonivel'); // ajuste se necess√°rio
            const json = await res.json();

            const nivel = json.nivel;
            setProgress(nivel);

            const agora = new Date();
            if (chartData.labels.length >= 10) {
            chartData.labels.shift();
            chartData.datasets[0].data.shift();
            }
            chartData.labels.push(formatHora(agora));
            chartData.datasets[0].data.push(nivel);

            nivelChart.update();
        } catch (err) {
            console.error('Erro ao buscar dados:', err);
            colorStatus.textContent = 'Erro ao carregar dados üò¢';
            colorStatus.style.color = '#e76f51';
        }
        }

        setInterval(atualizarDashboard, 5000);
        atualizarDashboard();

    </script>
  </body>
</html>